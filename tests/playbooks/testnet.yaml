- name: Create bios node
  hosts: localhost
  gather_facts: no
  connection: local
  tags: bios
  vars:
    machine_type: n1-standard-4
    image: ubuntu-1604-xenial-v20180418
    ansible_python_interpreter: /opt/ansible/bin/python
    host_list:
      - bootnode
    metadata: '{}'
    gce_zone: us-central1-a
    instance_tags: bootnode
    disk_size: 10
  roles:
    - roles/launch_host

- name: build/Start bios node
  hosts: bios
  connection: ssh
  become: True
  tags: bios
  vars:
    # eos information
    #eosio_github: https://github.com/EOSIO/eos
    eosio_version: 4.1.0-0
    # eosio
    eosio_user: eosio
    eosio_group: eosio
    eosio_pub_key: '{{ pub_key }}'
    eosio_priv_key: '{{ priv_key }}'
    eosio_log_dir: /var/log/eosio
    eosio_lib_dir: /var/lib/eosio
    eosio_home_opt: /home/{{ eosio_user }}/opt
    eosio_etc_dir: /etc/eosio
    eosio_etc_node_dir: '{{ eosio_etc_dir }}/node_00'
    # nodeos information
    nodeos_p2p_port: 9876
    nodeos_http_port: 8888
    nodeos_data_dir: /opt/eosio
    nodeos_config_dir: /opt/eosio
    nodeos_script_dir: /opt/eosio
    nodeos_run_script: "{{ nodeos_script_dir }}/nodeos.sh"
    nodeos_spool_dir: /var/spool/nodeos
    nodeos_pid_file: nodeos.pid
    nodeos_log_file: "{{ eosio_log_dir }}/nodeos.log"
    # producer info
    producer_name: eosio
    agent_name: "{{ ansible_hostname }}"
    # keosd
    keosd_http_port: 8880
    keosd_script_dir: "/opt/eosio"
    keosd_run_script: "{{ keosd_script_dir }}/keosd.sh"
    keosd_data_dir: "/opt/eosio"
    keosd_config_dir: "{{ nodeos_config_dir }}/keosd"
    keosd_spool_dir: /var/spool/keosd
    keosd_pid_file: keosd.pid
    keosd_log_file: "{{ eosio_log_dir }}/keosd.log"
  roles:
    - roles/eosio/install
    #- roles/eosio/start
    - roles/eosio/bios

- name: Create producing node - America
  hosts: localhost
  gather_facts: no
  connection: local
  tags: produce
  vars:
    machine_type: n1-standard-2
    image: ubuntu-1604-xenial-v20180418
    ansible_python_interpreter: /opt/ansible/bin/python
    host_list: "{{ groups.prod_us }}"
    #group_name: "{{ groups.prod_us| join(',' )}}"
    metadata: '{}'
    instance_tags: producers
    gce_zone: "us-central1-a"
    disk_size: 10
  roles:
    - roles/launch_host

- name: start producing nodes
  tags: produce
  hosts: prod_us
  connection: ssh
  become: True
  vars:
    # eos information
    #eosio_github: https://github.com/EOSIO/eos
    eosio_version: 4.1.0-0
    # bios information
    #discovery_url: https://keybase.pub/d3ck/{{ ansible_hostname }}-testnet.yaml
    #eosio_bios_version: 0.4.0
    #eosio_bios_dir: "{{ nodeos_config_dir }}/eos-bios"
    # eosio
    eosio_user: eosio
    eosio_group: eosio
    eosio_log_dir: /var/log/eosio
    eosio_lib_dir: /var/lib/eosio
    eosio_home_opt: /home/{{ eosio_user }}/opt
    eosio_etc_dir: /etc/eosio
    eosio_etc_node_dir: '{{ eosio_etc_dir }}/node_00'
    eosio_pub_key: EOS5ngXVNizw6quBW2Yx2rRTUwhRxSB3tJ7dYgoMn4RJRAk13gWvb
    # nodeos information
    nodeos_p2p_port: 9876
    nodeos_http_port: 8888
    nodeos_data_dir: /opt/eosio
    nodeos_config_dir: /opt/eosio
    nodeos_script_dir: /opt/eosio
    nodeos_run_script: "{{ nodeos_script_dir }}/nodeos.sh"
    nodeos_spool_dir: /var/spool/nodeos
    nodeos_pid_file: nodeos.pid
    nodeos_log_file: "{{ eosio_log_dir }}/nodeos.log"
    # producer info
    agent_name: "{{ ansible_hostname }}"
    producer_name: "{{ ansible_hostname }}"
    # keosd
    keosd_http_port: 8880
    keosd_script_dir: "/opt/eosio"
    keosd_run_script: "{{ keosd_script_dir }}/keosd.sh"
    keosd_data_dir: "/opt/eosio"
    keosd_config_dir: "{{ nodeos_config_dir }}/keosd"
    keosd_spool_dir: /var/spool/keosd
    keosd_pid_file: keosd.pid
    keosd_log_file: "{{ eosio_log_dir }}/keosd.log"
  roles:
    - roles/eosio/install
    - roles/eosio/start
    #- roles/eosio/voteproducer

- name: Create testing nodes
  tags: testers
  hosts: localhost
  gather_facts: no
  connection: local
  vars:
    machine_type: n1-standard-4
    image: ubuntu-1604-xenial-v20180418
    ansible_python_interpreter: /opt/ansible/bin/python
    group_name: "{{ groups.testers|join(',') }}"
    metadata: '{}'
    gce_zone: us-east1-b
    instance_tags: tester
    disk_size: 10
  roles:
    - roles/launch_host

- name: create testing node
  tags: testers
  hosts: testers
  connection: ssh
  become: True
  vars:
    # eos information
    eosio_github: https://github.com/EOSIO/eos
    eosio_version: 4.1.0-0
    # eosio
    eosio_user: eosio
    eosio_group: eosio
    eosio_pub_key: 'EOS5ngXVNizw6quBW2Yx2rRTUwhRxSB3tJ7dYgoMn4RJRAk13gWvb'
    eosio_log_dir: /var/log/eosio
    eosio_lib_dir: /var/lib/eosio
    eosio_home_opt: /home/{{ eosio_user }}/opt
    eosio_etc_dir: /etc/eosio
    eosio_etc_node_dir: '{{ eosio_etc_dir }}/node_00'
    # nodeos information
    nodeos_p2p_port: 9876
    nodeos_http_port: 8888
    nodeos_data_dir: /opt/eosio
    nodeos_config_dir: /opt/eosio
    nodeos_script_dir: /opt/eosio
    nodeos_run_script: "{{ nodeos_script_dir }}/nodeos.sh"
    nodeos_spool_dir: /var/spool/nodeos
    nodeos_pid_file: nodeos.pid
    nodeos_log_file: "{{ eosio_log_dir }}/nodeos.log"
    # producer info
    agent_name: "{{ ansible_hostname }}"
    producer_name: "{{ ansible_hostname }}"
    # keosd
    keosd_http_port: 8888
  roles:
    - roles/eosio/install